name: ğŸ”„ Repository Sync

on:
  workflow_dispatch:
    inputs:
      source_repo:
        description: 'æºä»“åº“ (æ ¼å¼ï¼šowner/repo)'
        required: true
        default: 'mozi9/kernel_xiaomi_sm8250'
        type: string
      source_branch:
        description: 'æºåˆ†æ”¯'
        required: true
        default: 'main'
        type: string
      target_repo:
        description: 'ç›®æ ‡ä»“åº“ (æ ¼å¼ï¼šowner/repo)'
        required: true
        default: 'mozi9/target-repo'
        type: string
      target_branch:
        description: 'ç›®æ ‡åˆ†æ”¯å'
        required: true
        default: 'sync-update'
        type: string

env:
  PAT_TOKEN: ${{ secrets.Mozi9_PAT }}

jobs:
  sync-repo:
    runs-on: ubuntu-latest
    steps:
    - name: ğŸ”„ åŒæ­¥ä»“åº“
      run: |
        # æ­£ç¡®é…ç½®Git
        git config --global user.name "mozi9"
        git config --global user.email "mozi9"
        
        # æ¸…ç†å¯èƒ½å­˜åœ¨çš„ä¸´æ—¶ç›®å½•
        rm -rf /tmp/repo-sync
        mkdir -p /tmp/repo-sync
        cd /tmp/repo-sync
        
        # æ­£ç¡®æ ¼å¼çš„ä»“åº“URL
        SOURCE_URL="https://mozi9:${{ env.PAT_TOKEN }}@github.com/${{ github.event.inputs.source_repo }}.git"
        TARGET_URL="https://mozi9:${{ env.PAT_TOKEN }}@github.com/${{ github.event.inputs.target_repo }}.git"
        
        echo "æ­£åœ¨å…‹éš†æºä»“åº“: $SOURCE_URL"
        git clone --depth 1 -b "${{ github.event.inputs.source_branch }}" "$SOURCE_URL" source-repo
        
        cd source-repo
        echo "å½“å‰åˆ†æ”¯: $(git branch --show-current)"
        
        echo "æ­£åœ¨æ¨é€åˆ°ç›®æ ‡ä»“åº“: $TARGET_URL"
        git push "$TARGET_URL" HEAD:refs/heads/${{ github.event.inputs.target_branch }}
        
        echo "âœ… åŒæ­¥å®Œæˆï¼"
        echo "åˆ†æ”¯: ${{ github.event.inputs.target_branch }}"
        echo "é“¾æ¥: https://github.com/${{ github.event.inputs.target_repo }}/tree/${{ github.event.inputs.target_branch }}"
