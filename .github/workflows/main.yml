name: ğŸ”„ Quick Repo Sync

on:
  workflow_dispatch:
    inputs:
      source_repo:
        description: 'æºä»“åº“ (owner/repo)'
        required: true
        type: string
      source_branch:
        description: 'æºåˆ†æ”¯'
        required: true
        default: 'main'
        type: string
      target_repo:
        description: 'ç›®æ ‡ä»“åº“ (owner/repo)'
        required: true
        type: string
      new_branch:
        description: 'æ–°åˆ†æ”¯å'
        required: true
        default: 'sync-branch'
        type: string

env:
  PAT_TOKEN: ${{ secrets.Mozi9_PAT }}

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ”„ åŒæ­¥ä»£ç 
        run: |
          # é…ç½®git
          git config --global user.name "mozi9"
          git config --global user.email "mozi9"
          
          # å…‹éš†æºä»“åº“
          git clone --depth 1 \
            -b "${{ github.event.inputs.source_branch }}" \
            "https://mozi9:${{ env.PAT_TOKEN }}@github.com/${{ github.event.inputs.source_repo }}.git" \
            source
          
          # æ¨é€åˆ°ç›®æ ‡ä»“åº“
          cd source
          git push \
            "https://mozi9:${{ env.PAT_TOKEN }}@github.com/${{ github.event.inputs.target_repo }}.git" \
            HEAD:refs/heads/${{ github.event.inputs.new_branch }}
          
          echo "âœ… å®Œæˆï¼åˆ†æ”¯: ${{ github.event.inputs.new_branch }}"
          echo "ğŸ”— https://github.com/${{ github.event.inputs.target_repo }}/tree/${{ github.event.inputs.new_branch }}"
