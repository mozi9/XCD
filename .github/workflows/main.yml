name: ğŸ”„ Simple Repo Sync

on:
  workflow_dispatch:
    inputs:
      source_repo:
        description: 'æºä»“åº“åœ°å€'
        required: true
        type: string
      source_branch:
        description: 'æºåˆ†æ”¯'
        required: true
        default: 'main'
        type: string
      target_repo:
        description: 'ç›®æ ‡ä»“åº“åœ°å€'
        required: true
        type: string
      target_branch:
        description: 'ç›®æ ‡åˆ†æ”¯å'
        required: true
        default: 'sync-branch'
        type: string

env:
  PAT_TOKEN: ${{ secrets.Mozi9_PAT }}

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ”„ åŒæ­¥ä»“åº“
      run: |
        # é…ç½®Git
        git config --global user.name "mozi9"
        git config --global user.email "mozi9"
        
        # å…‹éš†æºä»“åº“
        git clone --depth 1 \
          -b "${{ github.event.inputs.source_branch }}" \
          "https://mozi9:$PAT_TOKEN@github.com/${{{ github.event.inputs.source_repo '#https://github.com/' }}}" \
          source-repo
          
        cd source-repo
        
        # æ¨é€åˆ°ç›®æ ‡ä»“åº“
        git push "https://mozi9:$PAT_TOKEN@github.com/${{{ github.event.inputs.target_repo '#https://github.com/' }}}" \
          HEAD:refs/heads/"${{ github.event.inputs.target_branch }}"
        
        echo "âœ… åŒæ­¥å®Œæˆï¼"
        echo "åˆ†æ”¯: ${{ github.event.inputs.target_branch }}"
        echo "é“¾æ¥: https://github.com/${{{ github.event.inputs.target_repo '#https://github.com/' }}}/tree/${{ github.event.inputs.target_branch }}"
